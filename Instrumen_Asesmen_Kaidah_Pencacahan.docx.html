<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>ðŸ“‘ Lampiran 2 â€“ Instrumen Asesmen</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding:20px; background:#f0f4f8; }
    .container { background:white; padding:20px; border-radius:10px; box-shadow:0 4px 10px rgba(0,0,0,0.15); }
    .header { text-align:center; background:#2d3748; color:white; padding:20px; border-radius:8px; }
    .section { margin:25px 0; }
    h2 { border-bottom:3px solid #4299e1; padding-bottom:5px; }
    .lkpd-input, textarea { width:100%; padding:10px; margin-top:5px; border:1px solid #ccc; border-radius:6px; }
    .upload-area { border:2px dashed #4299e1; padding:15px; text-align:center; margin-top:10px; cursor:pointer; }
    .image-preview img { max-width:120px; margin:5px; border-radius:6px; }
    .download-btn { display:block; width:100%; padding:15px; margin-top:25px; background:#3182ce; color:white; font-weight:bold; border:none; border-radius:6px; cursor:pointer; }
    .download-btn:hover { background:#2b6cb0; }
    .filled-input { background:#edf2f7; padding:8px; border-radius:4px; margin:6px 0; }
    table { width:100%; border-collapse:collapse; margin-top:15px; }
    th, td { border:1px solid #ccc; padding:10px; }
    th { background:#3182ce; color:white; }
  </style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>ðŸ“‘ Lampiran 2 â€“ Instrumen Asesmen</h1>
  </div>

  <div class="section">
    <h2>ðŸ‘¤ Identitas</h2>
    <input type="text" id="userName" class="lkpd-input" placeholder="Nama Anda untuk nama file PDF">
  </div>

  <div class="section">
    <h2>A. Contoh Soal</h2>
    <ol>
      <li>Sebutkan bentuk umum fungsi kuadrat!</li>
      <li>Apa yang dimaksud parabola terbuka ke atas/bawah?</li>
    </ol>
  </div>

  <div class="section">
    <h2>B. LKPD</h2>
    <textarea id="groupName" placeholder="Nama kelompok"></textarea>
    <textarea id="members" placeholder="Anggota"></textarea>
    <textarea id="parabolaExample" placeholder="Contoh parabola"></textarea>
    <div class="upload-area" id="uploadArea">ðŸ“· Klik/drag gambar ke sini
      <input type="file" id="imageUpload" accept="image/*" multiple style="display:none">
    </div>
    <div class="image-preview" id="imagePreview"></div>
  </div>

  <div class="section">
    <h2>C. Rubrik Penilaian</h2>
    <table>
      <tr><th>Aspek</th><th>Skor 4</th><th>Skor 3</th></tr>
      <tr><td>Partisipasi</td><td>Aktif penuh</td><td>Cukup aktif</td></tr>
    </table>
  </div>

  <button class="download-btn" id="downloadPdf">ðŸ“¥ Unduh sebagai PDF</button>
</div>

<script>
const uploadArea = document.getElementById("uploadArea");
const imageUpload = document.getElementById("imageUpload");
const imagePreview = document.getElementById("imagePreview");
let uploadedImages = [];

uploadArea.addEventListener("click", () => imageUpload.click());
imageUpload.addEventListener("change", () => handleFiles(imageUpload.files));

function handleFiles(files) {
  imagePreview.innerHTML = "";
  uploadedImages = [];
  Array.from(files).forEach(file=>{
    if(!file.type.match("image.*")) return;
    const reader=new FileReader();
    reader.onload=(e)=>{
      const img=document.createElement("img");
      img.src=e.target.result;
      imagePreview.appendChild(img);
      uploadedImages.push(e.target.result);
    };
    reader.readAsDataURL(file);
  });
}

document.getElementById("downloadPdf").addEventListener("click", ()=>{
  const pdfContent=document.createElement("div");
  pdfContent.innerHTML=document.querySelector(".container").innerHTML;

  // Ganti semua input/textarea dengan div berisi value
  pdfContent.querySelectorAll("input,textarea").forEach(el=>{
    const div=document.createElement("div");
    div.className="filled-input";
    div.innerText=el.value || "-";
    el.parentNode.replaceChild(div, el);
  });

  // Ganti preview gambar dengan salinan base64
  const clonedPreview=pdfContent.querySelector("#imagePreview");
  if(clonedPreview){
    clonedPreview.innerHTML="";
    uploadedImages.forEach(src=>{
      const img=document.createElement("img");
      img.src=src;
      clonedPreview.appendChild(img);
    });
  }

  // Hapus tombol unduh di PDF
  const btn=pdfContent.querySelector("#downloadPdf");
  if(btn) btn.remove();

  const userName=document.getElementById("userName").value.trim()||"siswa";
  const opt={
    margin:10,
    filename:`Instrumen_Asesmen_${userName}.pdf`,
    image:{type:"jpeg",quality:0.98},
    html2canvas:{scale:2,useCORS:true},
    jsPDF:{unit:"mm",format:"a4",orientation:"portrait"}
  };

  html2pdf().set(opt).from(pdfContent).save();
});
</script>
</body>
</html>
